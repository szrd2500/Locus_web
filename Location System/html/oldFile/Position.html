<!DOCTYPE html>
<html>

<head>
    <title>Location System</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel=stylesheet type="text/css" href="..\css\head_type.css">
    <link rel=stylesheet type="text/css" href="..\css\drop_down_menu.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
        /* Create three unequal columns that floats next to each other */
    .column {
        float: left;
        padding: 10px;
    }

    /* Left and right column */
    .column.side {
        width: 30%;
    }

    /* Middle column */
    .column.main {
        width: 70%;
    }

    /* Clear floats after the columns */
    .row:after {
        content: "";
        display: table;
        clear: both;
    }

    /* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
    @media screen and (max-width: 600px) {

        .column.main,
        .column.side {
            width: 100%;
        }
    }


    /* Style the navigation menu */
    nav {
        -webkit-flex: 1;
        -ms-flex: 1;
        flex: 1;
        background: #ccc;
        height: 400px;
        overflow: auto;
        border: 1px black solid;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th,
    td {
        padding: 8px;
        text-align: left;
        border: 1px solid #808080;
    }

    tr:hover {
        background-color: #f5f5f5;
    }

    </style>
    <script type="text/javascript" src="..\js\use_canvas.js"></script>
    <script type="text/javascript">
        function createCanvas(img, width, height) {
            var canvas = document.getElementById('canvas');
            canvas.style.background = "url(" + img + ")";
            canvas.width = width;
            canvas.height = height;
            return canvas;
        }

        function loadFile(file) {
            //var file = input.files[0];
            var src = URL.createObjectURL(file);
            //var src = input;
            var img = new Image();
            img.src = src;
            img.onload = function () {
                var i_width = img.width;
                var i_height = img.height;
                var canvas = createCanvas(src, i_width, i_height);
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, width, height);
                ctx.save();
            };
        }

        function GetXmlHttpObject() {
            var xmlHttp = null;
            try {// Firefox, Opera 8.0+, Safari
                xmlHttp = new XMLHttpRequest();
            }
            catch (e) {//Internet Explorer
                try {
                    xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
                }
                catch (e) {
                    xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
            }
            return xmlHttp;
        }

        function update1(url, locationID) {
            var xmlHttp = GetXmlHttpObject();
            if (xmlHttp == null) {
                alert("Browser does not support HTTP Request");
                return;
            }
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 || xmlHttp.readyState == "complete") {
                    var table1 = "<table><tr style=\"background:lightgray;\">" +
                        "<th>Items</th>" +
                        "<th>Name</th>" +
                        "<th>ID</th>" +
                        "<th>Time</th>" +
                        "<th>Alarm Status</th>" +
                        "<th>Image</th></tr>";
                    var revObj = JSON.parse(this.responseText);
                    for (i in revObj.items) {
                        table1 += "<tr><td>" + revObj.items[i] +
                            "</td><td>" + revObj.name[i] +
                            "</td><td>" + revObj.id[i] +
                            "</td><td>" + revObj.time[i] +
                            "</td><td>" + revObj.alarm_status[i] +
                            "</td><td>" + revObj.image[i] +
                            "</td></tr>";
                    }
                    table1 += "</table>";
                    document.getElementById(locationID).innerHTML = table1;
                }
            };
            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.send();
        }

        function update2(url, locationID) {
            var xmlHttp = GetXmlHttpObject();
            if (xmlHttp == null) {
                alert("Browser does not support HTTP Request");
                return;
            }
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 || xmlHttp.readyState == "complete") {
                    var table2 = "<table><tr style=\"background:lightgray;\">" +
                        "<th>Items</th>" +
                        "<th>Display ID</th>" +
                        "<th>Name</th>" +
                        "<th>Tag List</th></tr>";
                    var revObj = JSON.parse(this.responseText);
                    for (i in revObj.items) {
                        table2 += "<tr><td>" + revObj.items[i] +
                            "</td><td>" + revObj.display_id[i] +
                            "</td><td>" + revObj.name[i] +
                            "</td><td>" + revObj.tag_list[i] +
                            "</td></tr>";
                    }
                    table2 += "</table>";
                    document.getElementById(locationID).innerHTML = table2;
                }
            };
            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.send();
        }

        function update3(url) {
            var xmlHttp = GetXmlHttpObject();
            if (xmlHttp == null) {
                alert("Browser does not support HTTP Request");
                return;
            }
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4 || xmlHttp.readyState == "complete") {
                    var revObj = JSON.parse(this.responseText);
                    document.getElementById("x").value = revObj.x;
                    document.getElementById("y").value = revObj.y;
                }
            };
            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.send();
        }

        function update4() {
            var xmlHttp = GetXmlHttpObject();
            if (xmlHttp == null) {
                alert("Browser does not support HTTP Request");
                return;
            }
            xmlHttp.onreadystatechange = function () {

            };
            xmlHttp.open("POST", "request4", true);
            xmlHttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlHttp.send();
        }

        function autoChangeHint() {
            update1("request1", "txtHint1");
            update2("request2", "txtHint2");
            update3("request3");
            //update4();
        }

        setInterval('autoChangeHint()', 500);

        function getServerImage() {
            var oReq = new XMLHttpRequest();
            oReq.open("POST", "requestImage", true);
            oReq.responseType = "blob";
            oReq.onreadystatechange = function () {
                if (oReq.readyState == oReq.DONE) {
                    var blob = oReq.response;
                    loadFile(blob);
                }
            }
            oReq.send();
        }

        function changePage(url) {
            var xmlHttp = GetXmlHttpObject();
            if (xmlHttp == null) {
                alert("Browser does not support HTTP Request");
                return;
            }
            xmlHttp.onreadystatechange = function () {
                //document.getElementById("demo").innerHTML
                document.body.innerHTML = this.responseText;
            };
            xmlHttp.open("GET", url, true);
            xmlHttp.send();
        }
    </script>
</head>

<body>
    <div class="header">
        <label>RFID Monitoring Station</label>
    </div>
    <ul class="head-title">
        <li><a class="active" href="Position.html">Position</a></li>
        <li><a href="Device Connection.html">Device Connection</a></li>
        <li><a href="Device Setting.html">Device Setting</a></li>
        <li><a href="RF Setting.html">RF Setting</a></li>
        <li><a href="Inventory.html">Inventory</a></li>
        <li><a href="Reference.html">Reference</a></li>
        <li><a href="Advance cmd.html">Advance cmd</a></li>
        <li><a href="Update.html">Update</a></li>
        <li style="float:right"><a href="About.html">About</a></li>
    </ul>

    <ul class="drop-down-menu">
        <li><a href="#">Setting</a>
            <ul>
                <li><a href="#">Map Setting</a>
                    <ul>
                        <li><a href="#">Map Select</a>
                        </li>
                        <li><a href="#">Map Scale</a>
                        </li>
                    </ul>
                </li>
                <li><a href="#">Anchor Setting</a>
                    <ul>
                        <li><a href="#">Anchor Position</a>
                        </li>
                        <li><a href="#">Anchor List</a>
                        </li>
                        <li><a href="#">Anchor Group</a>
                        </li>
                    </ul>
                </li>
                <li><a href="#">Tag Setting</a>
                </li>
            </ul>
        </li>
        <li><a href="#">Start</a>
        </li>
        <li><a href="#">Record Mode</a>
        </li>
        <li><a href="#">Windows Interface Setting</a>
            <ul>
                <li><a href="#">Tag List Window</a>
                    <ul>
                        <li><a href="#">Window Display</a>
                        </li>
                        <li><a href="#">Latest Items</a>
                        </li>
                    </ul>
                </li>
                <li><a href="#">Alarm List Window</a>
                    <ul>
                        <li><a href="#">Window Display</a>
                        </li>
                        <li><a href="#">Latest Items</a>
                        </li>
                    </ul>
                </li>
                <li><a href="#">Alarm Window</a>
                </li>
                <li><a href="#">Anchor Display</a>
                </li>
            </ul>
        </li>
    </ul>
    <div class="column main">
        <div class="row">
            <nav>
                <canvas id="canvas"></canvas>
            </nav>
            <form name='form' id='form' style="float: right;">
                <br>
                <form name='form' id='form'>
                    X:<input type="text" name="x" id="x" value="" style="max-width: 50px;">
                    Y:<input type="text" name="y" id="y" value="" style="max-width: 50px;">
                    <input type='button' name='submit' value='畫點' onclick='draw_dot();' />
                </form>
            </form>
            <div style="float: right;">
                <br><input type="file" id="file" accept="image/png" onchange="loadFile(this.files[0])">
                <button onclick="getServerImage();" style="margin-right:30px;">導入底圖</button>
            </div>
        </div>
        <div class="row" style="overflow:auto; margin:5px;">
            <div id="txtHint1">尚未載入資料</div>
        </div>
    </div>
    <div class="column side" style="overflow:auto; margin-top:10px;">
        <div id="txtHint2">尚未載入資料</div>
    </div>
    <div id="txtHint3"></div>
</body>

</html>